#Genome assemblies 

### Flye assembly command for nanopore and pacbio
flye --nano-hq ./pacbio_reads/m64047_220322_210536.ccs.fastq.gz ./pacbio_reads/m64047_220522_063338.ccs.fastq.gz ./pacbio_reads/m64047_210924_101806.ccs.fastq.gz ./nanopore_reads/basecalling_ligationseq/pass/combined.fastq ./nanopore_reads/basecalling_ligationseq2/pass/combined2.fastq --out-dir whelk_genome_flye_nanopac_08282022 --threads 100

### Smartdenovo assembly commands for nanopore and pacbio data
smartdenovo.pl -t 60 -p pb1 -c 1 ./combinedlrseq.fa.gz > smartdenovo_assembly_nanopac_09012022.mak
make -f ./smartdenovo_assembly_nanopac_09012022.mak

### Spades assembly commands for illumina novaseq data
spades.py --pe1-1 ./genome/novaseq_reads/R1_paired.fastq --pe1-2 ./genome/novaseq_reads/R2_paired.fastq \
-t 100 -m 900 -o ./genome/spades_assembly_12022022


### ABySS assembly commands for illumina novaseq data
abyss-pe name=abyss_genome_(date) j=60 k=80 B=500G in='./genome/novaseq_reads/R1_paired.fastq ./genome/novaseq_reads/R2_paired.fastq'

### MaSuRCA assembly config file and command for Illumina Nanopore and Pacbio Data (long read data in combinedlrseq.fa.gz)
# need bzip2, numactl, and boost to run Masurca - will end in error during pre correction of long reads if absent

conda install -c anaconda bzip2
conda install -c brown-data-science numactl
conda install -c conda-forge boost

# uploaded MaSuRCA4.0.9 directly and created config file 
# config.txt 
# configuration file (10/04/2022)
DATA
PE = pe 500 50 /large/whelk/genome/novaseq_reads/R1_paired.fastq.gz /large/whelk/genome/novaseq_reads/R2_paired.fastq.gz
NANOPORE = /large/whelk/genome/combinedlrseq.fa.gz
END
PARAMETERS
EXTEND_JUMP_READS=0
GRAPH_KMER_SIZE = auto
USE_LINKING_MATES = 0
USE_GRID=0
GRID_ENGINE=SGE
GRID_QUEUE=all.q
GRID_BATCH_SIZE=500000000
LHE_COVERAGE=25
LIMIT_JUMP_COVERAGE = 300
CA_PARAMETERS =  cgwErrorRate=0.15
CLOSE_GAPS=1
NUM_THREADS = 64
JF_SIZE = 74000000000
SOAP_ASSEMBLY=0
FLYE_ASSEMBLY=1
END

# command for Masurca assembly
./MaSuRCA-4.0.9/bin/masurca ./masurca_assembly_10042022/config.txt

./assemble.sh

# assembly restart by runing both commands again (creates new assemble.sh based on what files have already be constructed): 
./MaSuRCA-4.0.9/bin/masurca ./masurca_assembly_10042022/config.txt

./assemble.sh 


### Command for Flye assembly using Masurca super_reads and masurca corrected long read data (pacbio and nanopore) 
# this was conducted due to a bug error in Masurca output - assembly is consistent with/the same as Masurca output
flye --pacbio-corr /large/whelk/genome/masurca_assembly_10292022/mr.99.17.15.0.02.1.fa /large/whelk/genome/masurca_assembly_10292022/work1/superReadSequences.fasta --out-dir whelk_genome_flye_hack_11232022 --genome-size 2.4g --threads 60

old stuff ^^^
____________________________________________________________________________________________________________________________________________________________

# spades assembly on corrected short reads
conda create -n abyss
conda activate abyss
conda install -c bioconda abyss
conda install -c bioconda arcs tigmint

#abyss assembly
abyss-pe name=abyss_genome_03312023 j=60 k=80 B=800G in='./novaseq_reads/fastp_out.R1_10032022.fq.gz ./novaseq_reads/fastp_out.R2_10032022.fq.gz'

# busco
busco -i ./abyss_genome_03312023-contigs.fa -o ./abyss_genome_03312023_metazoabusco -m genome -l metazoa_odb10 --cpu 100

_ _ _ _ _ _ _ _ _ _ _ _ _ _ 

# Flye assembly with corrected long reads
conda create -n flye2.9.2
conda install -c bioconda flye
conda activate flye2.9.2

# flye assembly
flye --nano-hq ./pacbio_reads/m64047_220322_210536.ccs.fastq.gz  ./pacbio_reads/m64047_220522_063338.ccs.fastq.gz ./pacbio_reads/m64047_210924_101806.ccs.fastq.gz ./nanopore_reads/basecalling_ligationseq/pass/fastp_combined.fastq ./nanopore_reads/basecalling_ligationseq2/pass/fastp_combined2.fastq  --out-dir ./whelk_genome_flye_nanopac_fastp_04252023 --threads 100

#busco
busco -i /large/whelk/genome/whelk_genome_flye_nanopac_fastp_04252023/assembly.fasta -o ./whelk_genome_flye_04252023_metazoabusco -m genome -l metazoa_odb10 --cpu 100 --update-data -f

_ _ _ _ _ _ _ _ _ _ _ _ _ _ 

# RNA_BESST scaffolding with RNA-seq data

# hisat2 read alignment
conda create -n hisat2
conda install -c bioconda hisat2

# create indexing file for genome 
hisat2-build /large/whelk/genome/whelk_genome_flye_nanopac_fastp_04252023/assembly.fasta genome

# RNA-seq read alignment
for sample in `cat /large/whelk/transcriptome/filtered_spadestranscriptome/sample_list.txt`
do
  hisat2 -x genome -1 /large/whelk/transcriptome/kw_fastq_all_trimmed/${sample}_1_paired.fq.gz -2 /large/whelk/transcriptome/kw_fastq_all_trimmed/${sample}_2_paired.fq.gz -S /large/whelk/genome/hisat2/rna/${sample}_out.bam
done

# Samtools sorting and indexing bam files
conda create -n samtools
conda install -c bioconda samtools

# sorting BAM files
for sample in `cat /large/whelk/transcriptome/filtered_spadestranscriptome/sample_list.txt`
do
  samtools sort ${sample}_out.bam -o ${sample}_sorted.bam
done

# merging bam files
samtools merge all.bam /large/whelk/genome/hisat2/sorted_bam/*.bam

#indexing combined bam file
samtools index all.bam  all.bam.bai

# downloading RNA_BESST
???

# RNA_BESST scaffolding
python Main.py 1 -c /large/whelk/genome/whelk_genome_flye_nanopac_fastp_04252023/assembly.fasta -f /large/whelk/genome/hisat2/sorted_bam/all.bam -o /large/whelk/genome/besst_rna 

# alignment of illumina novaseq reads
hisat2 -x genome -1 /large/whelk/genome/novaseq_reads/fastp_out.R1_10032022.fq -2 /large/whelk/genome/novaseq_reads/fastp_out.R2_10032022.fq -S output_novaseq.bam

# sorting bam file
samtools sort output_novaseq.bam -o novaseq_sorted.bam

# idexing bam file
samtools index novaseq_sorted.bam  novaseq_sorted.bam.bai

# BESST scaffolding with novaseq reads
conda create --name besst4 python=2.7
conda activate besst4
conda install -c bioconda mathstats
conda install -c bioconda pysam
conda install -c prometeia networkx
conda install -c anaconda numpy
conda install -c anaconda scipy
conda install -c conda-forge matplotlib

# BESST scaffolding
./runBESST -c /large/whelk/genome/besst_rna/default_param/pass1/Scaffolds-pass1.fa -f /large/whelk/genome/hisat2/rnascaf_genome/novaseq_sorted.bam -o /large/whelk/genome/final_scaf.fasta -orientation fr

